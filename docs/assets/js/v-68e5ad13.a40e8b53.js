"use strict";(self.webpackChunkjava_note_vuepress2=self.webpackChunkjava_note_vuepress2||[]).push([[9320],{70247:(s,n,a)=>{a.r(n),a.d(n,{data:()=>t});const t={key:"v-68e5ad13",path:"/other/99-aliOSS.html",title:"阿里 OSS 实现文件上传",lang:"zh-CN",frontmatter:{},excerpt:"",headers:[{level:2,title:"注册和初步使用",slug:"注册和初步使用",children:[]},{level:2,title:"在 Java 代码中上传图片",slug:"在-java-代码中上传图片",children:[]}],filePathRelative:"other/99-aliOSS.md",git:{updatedTime:1629711344e3,contributors:[{name:"hemiao",email:"hemiao3000@126.com",commits:1}]}}},66654:(s,n,a)=>{a.r(n),a.d(n,{default:()=>u});var t=a(66252);const e=(0,t.uE)('<h1 id="阿里-oss-实现文件上传" tabindex="-1"><a class="header-anchor" href="#阿里-oss-实现文件上传" aria-hidden="true">#</a> 阿里 OSS 实现文件上传</h1><p>对象存储服务（Object Storage Service，OSS）是一种海量、安全、低成本、高可靠的云存储服务，适合存放任意类型的文件。容量和处理能力弹性扩展，多种存储类型供选择，全面优化存储成本。</p><p>简单来说，OSS 是一个第三方服务，你将文件存在它那里，它返回给你一个链接，回头你通过这个链接能再次下载到这个文件。</p><p>国内使用最广泛的是阿里的 OSS 服务。</p><p><img src="/images/other/img/alioss-01.png" alt=""></p><h2 id="注册和初步使用" tabindex="-1"><a class="header-anchor" href="#注册和初步使用" aria-hidden="true">#</a> 注册和初步使用</h2><p>使用阿里的 OSS 服务首先需要开通它，因为官网有指导视频，这里我就不演示过程。</p><ul><li><p>开通前</p><p><img src="/images/other/img/alioss-02.png" alt=""></p></li><li><p>开通后</p><p><img src="/images/other/img/alioss-03.png" alt=""></p></li></ul><p>OSS 中规定你所上传的文件必须在一个 Bucket 中，及，Bucket 是文件的容器，文件不能被上传到 Bucket 之外。</p><p>由于新用户注册 OSS 后，初始是没有任何 Bucket 的，所以我们首先需要先创建至少一个 Bucket 。</p><p><img src="/images/other/img/alioss-04.png" alt=""></p><p><img src="/images/other/img/alioss-05.png" alt=""></p><p><img src="/images/other/img/alioss-06.png" alt=""></p><p>在页面上，你可以直接上传文件。</p><p>除了 Bucket 之外，在未来我们<small>（通过代码）</small>对阿里 OSS 的使用中，我们还需要 2 个关键数据：<strong>accessKeyId</strong> 和 <strong>accessKeySecret</strong> 。</p><p><img src="/images/other/img/alioss-07.png" alt=""></p><p><img src="/images/other/img/alioss-08.png" alt=""></p><p><img src="/images/other/img/alioss-09.png" alt=""></p><p>accessKeyId 和 accessKeySecret 就是我们（的代码）连接阿里 OSS 的『用户名和密码』。</p><h2 id="在-java-代码中上传图片" tabindex="-1"><a class="header-anchor" href="#在-java-代码中上传图片" aria-hidden="true">#</a> 在 Java 代码中上传图片</h2>',20),p=(0,t.Uk)("阿里 OSS 官方有丰富的文档，为大家提供了不少现成的 demo 以供学习、参考："),l={href:"https://help.aliyun.com/document_detail/195870.html",target:"_blank",rel:"noopener noreferrer"},c=(0,t.Uk)("Java SDK 快速入门"),o=(0,t.Uk)(" 。"),i=(0,t.uE)('<ol><li><p>引入 OSS 的 Maven 依赖：</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.aliyun.oss<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>aliyun-sdk-oss<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.12.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li><li><p>创建 OSSClient</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">new</span> <span class="token class-name">OSSClientBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>\n  <span class="token string">&quot;&lt;endpoint, http://oss-cn-hangzhou.aliyuncs.com&gt;&quot;</span><span class="token punctuation">,</span> \n  <span class="token string">&quot;&lt;accessKeyId&gt;&quot;</span><span class="token punctuation">,</span> \n  <span class="token string">&quot;&lt;accessKeySecret&gt;&quot;</span>\n<span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li><li><p>上传文件</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>ossClient<span class="token punctuation">.</span><span class="token function">putObject</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;bucketName&gt;&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&lt;key&gt;&quot;</span><span class="token punctuation">,</span> inputstream<span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div></li><li><p>其它操作</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 设置文件的访问权限</span>\nossClient<span class="token punctuation">.</span><span class="token function">setObjectAcl</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;bucketName&gt;&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&lt;key&gt;&quot;</span><span class="token punctuation">,</span> <span class="token class-name">CannedAccessControlList<span class="token punctuation">.</span>PublicRead</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 获得访问 url 。如果是公开读的权限，可自己拼接出 url，无须调用方法。</span>\n<span class="token class-name">URL</span> url <span class="token operator">=</span> ossClient<span class="token punctuation">.</span><span class="token function">generatePresignedUrl</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;bucketName&gt;&quot;</span><span class="token punctuation">,</span> key<span class="token punctuation">,</span> expiration<span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li></ol>',1),u={render:function(s,n){const a=(0,t.up)("OutboundLink");return(0,t.wg)(),(0,t.iD)(t.HY,null,[e,(0,t._)("p",null,[p,(0,t._)("a",l,[c,(0,t.Wm)(a)]),o]),i],64)}}}}]);