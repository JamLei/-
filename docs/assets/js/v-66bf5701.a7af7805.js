"use strict";(self.webpackChunkjava_note_vuepress2=self.webpackChunkjava_note_vuepress2||[]).push([[6243],{28087:(s,n,a)=>{a.r(n),a.d(n,{data:()=>e});const e={key:"v-66bf5701",path:"/docker-install/02-redis.html",title:"Docker Redis",lang:"zh-CN",frontmatter:{},excerpt:"",headers:[{level:2,title:"安装及测试",slug:"安装及测试",children:[]},{level:2,title:"容器中的配置文件和数据的存储",slug:"容器中的配置文件和数据的存储",children:[]},{level:2,title:"配置与挂载",slug:"配置与挂载",children:[]},{level:2,title:"docker-compose 启动",slug:"docker-compose-启动",children:[]}],filePathRelative:"docker-install/02-redis.md",git:{updatedTime:1629711344e3,contributors:[{name:"hemiao",email:"hemiao3000@126.com",commits:1}]}}},46331:(s,n,a)=>{a.r(n),a.d(n,{default:()=>t});var e=a(66252);const p=(0,e._)("h1",{id:"docker-redis",tabindex:"-1"},[(0,e._)("a",{class:"header-anchor",href:"#docker-redis","aria-hidden":"true"},"#"),(0,e.Uk)(" Docker Redis")],-1),l=(0,e.Uk)("docker hub 网址："),r={href:"https://hub.docker.com/_/redis",target:"_blank",rel:"noopener noreferrer"},c=(0,e._)("em",null,"https://hub.docker.com/_/redis",-1),i=(0,e.uE)('<p>当前<small>（2020-04-02）</small> <strong>latest</strong> 版本和 <strong>6.2.1</strong> 是同一个版本。</p><h2 id="安装及测试" tabindex="-1"><a class="header-anchor" href="#安装及测试" aria-hidden="true">#</a> 安装及测试</h2><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 查询中央仓库</span>\ndocker search -f is-official<span class="token operator">=</span>true redis\n\n<span class="token comment"># 从中央仓库下载</span>\ndocker pull redis:6.2.1\n\n<span class="token comment"># 或，直接导入已有的镜像文件</span>\n<span class="token comment"># docker load -i redis-6.2.1.tar</span>\n\n<span class="token comment"># 查看本地镜像</span>\ndocker images\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>会出现类似以下内容：</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>REPOSITORY  TAG      IMAGE ID        CREATED        SIZE\nredis       <span class="token number">6.2</span>.1    7f33e76fcb56    <span class="token number">45</span> hours ago   105MB\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>运行容器：</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 删除曾经已有的同名容器</span>\ndocker stop redis-test\ndocker <span class="token function">rm</span> redis-test\n\n<span class="token comment"># 创建并运行 redis 容器的语法</span>\ndocker run -d --name <span class="token operator">&lt;</span>指定容器名<span class="token operator">&gt;</span> -p <span class="token operator">&lt;</span>指定宿主机端口<span class="token operator">&gt;</span>:6379 redis:6.2.1\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>例如：</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>docker run <span class="token punctuation">\\</span>\n   -d <span class="token punctuation">\\</span>\n   --name redis-test <span class="token punctuation">\\</span>\n   -p <span class="token number">6379</span>:6379 <span class="token punctuation">\\</span>\n   redis:6.2.1\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>验证安装成功</p><ul><li><p>通过 <strong>docker ps</strong> 命令查看容器的运行信息：</p><p>略</p></li><li><p>进入 redis-test 容器</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>docker <span class="token builtin class-name">exec</span> -it redis-test /bin/bash\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div></li><li><p>执行 <code>redis-cli</code> 连接 redis server</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>redis-cli\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div></li></ul><p>后续可选操作：</p><ul><li><p>设置键值对</p><p>连上 Redis Server 之后，执行 redis 命令：<code>set test 1</code>，会显示 <code>OK</code> 。</p></li><li><p>从容器外部连接</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>redis-cli -h <span class="token operator">&lt;</span>宿主机IP<span class="token operator">&gt;</span> -p <span class="token operator">&lt;</span>宿主机端口<span class="token operator">&gt;</span> -a <span class="token operator">&lt;</span>登录密码<span class="token operator">&gt;</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div></li></ul><h2 id="容器中的配置文件和数据的存储" tabindex="-1"><a class="header-anchor" href="#容器中的配置文件和数据的存储" aria-hidden="true">#</a> 容器中的配置文件和数据的存储</h2><p>早期的 Docker Redis 在容器中有默认的配置文件。</p><p>不过，从 5 版本开始 Docker Redis 改变了思路，容器内部不在包含配置文件，而是<strong>要求容器启动时指定宿主机中的一个文件作为配置文件</strong>。</p><p>例如：</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>docker run <span class="token punctuation">\\</span>\n  <span class="token punctuation">..</span>. <span class="token punctuation">\\</span>\n  -v <span class="token operator">&lt;</span>宿主机上的redis.conf<span class="token operator">&gt;</span>:/usr/local/etc/redis/redis.conf <span class="token punctuation">\\</span>\n  redis:6.2.1 <span class="token punctuation">\\</span>\n  redis-server /usr/local/etc/redis/redis.conf <span class="token punctuation">\\</span>\n  <span class="token punctuation">..</span>.\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><small>当然，如果你没有提供配置文件，它还是有默认的配置的，只不过你在容器中找不到配置文件。</small></p><p>5.0.6 的默认的配置文件的有效内容见最后。</p><hr><p>Docker Redis Server 的数据的存储目录在容器内部的</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>/data\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>很显然，只有开启持久化功能时，才会有数据存储于此。</p><h2 id="配置与挂载" tabindex="-1"><a class="header-anchor" href="#配置与挂载" aria-hidden="true">#</a> 配置与挂载</h2><ul><li><p>删除已存在的同名容器</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>docker stop redis-6379\ndocker <span class="token function">rm</span> redis-6379\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>后续可通过 <em>docker run</em> 的 <strong>--rm</strong> 选项免去『删除』这步操作。</p></li><li><p>创建本机挂载目录</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">mkdir</span> -p ~/docker/redis/6379/data\n<span class="token function">touch</span> ~/docker/redis/6379/redis.conf\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li><li><p>创建并运行容器</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>docker run <span class="token punctuation">\\</span>\n   -d <span class="token punctuation">\\</span>\n   --rm <span class="token punctuation">\\</span>\n   --name redis-6379 <span class="token punctuation">\\</span>\n   -p <span class="token number">6379</span>:6379 <span class="token punctuation">\\</span>\n   -v ~/docker/redis/6379/redis.conf:/usr/local/etc/redis/redis.conf <span class="token punctuation">\\</span>\n   -v ~/docker/redis/6379/data:/data <span class="token punctuation">\\</span>\n   redis:6.2.1 <span class="token punctuation">\\</span>\n   redis-server /usr/local/etc/redis/redis.conf <span class="token punctuation">\\</span>\n   --appendonly <span class="token function">yes</span> \n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div></li><li><p><strong>--appendonly yes</strong> 开启 Redis 持久化功能。</p></li></ul><h2 id="docker-compose-启动" tabindex="-1"><a class="header-anchor" href="#docker-compose-启动" aria-hidden="true">#</a> docker-compose 启动</h2><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">&#39;3&#39;</span>\n<span class="token key atrule">services</span><span class="token punctuation">:</span>\n  <span class="token key atrule">redis</span><span class="token punctuation">:</span>\n    <span class="token key atrule">image</span><span class="token punctuation">:</span> redis<span class="token punctuation">:</span><span class="token number">5.0</span>\n    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> redis<span class="token punctuation">-</span><span class="token number">6379</span>\n    <span class="token key atrule">mem_limit</span><span class="token punctuation">:</span> 512m\n    <span class="token key atrule">ports</span><span class="token punctuation">:</span>\n      <span class="token punctuation">-</span> 6379<span class="token punctuation">:</span><span class="token number">6379</span>\n    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>\n      <span class="token punctuation">-</span> <span class="token string">&quot;~/docker/6379/data:/data&quot;</span>\n      <span class="token punctuation">-</span> <span class="token string">&quot;./docker/6379/redis.conf:/usr/local/etc/redis/redis.conf&quot;</span>\n    <span class="token key atrule">command</span><span class="token punctuation">:</span>\n      redis<span class="token punctuation">-</span>server /usr/local/etc/redis/redis.conf <span class="token punctuation">-</span><span class="token punctuation">-</span>appendonly yes\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><hr><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>bind 127.0.0.1\nprotected-mode yes\nport 6379\ntcp-backlog 511\ntimeout 0\ntcp-keepalive 300\ndaemonize no\nsupervised no\npidfile /var/run/redis_6379.pid\nloglevel notice\nlogfile &quot;&quot;\ndatabases 16\nalways-show-logo yes\nsave 900 1\nsave 300 10\nsave 60 10000\nstop-writes-on-bgsave-error yes\nrdbcompression yes\nrdbchecksum yes\ndbfilename dump.rdb\ndir ./\nreplica-serve-stale-data yes\nreplica-read-only yes\nrepl-diskless-sync no\nrepl-diskless-sync-delay 5\nrepl-disable-tcp-nodelay no\nreplica-priority 100\nlazyfree-lazy-eviction no\nlazyfree-lazy-expire no\nlazyfree-lazy-server-del no\nreplica-lazy-flush no\nappendonly no\nappendfilename &quot;appendonly.aof&quot;\nappendfsync everysec\nno-appendfsync-on-rewrite no\nauto-aof-rewrite-percentage 100\nauto-aof-rewrite-min-size 64mb\naof-load-truncated yes\naof-use-rdb-preamble yes\nlua-time-limit 5000\nslowlog-log-slower-than 10000\nslowlog-max-len 128\nlatency-monitor-threshold 0\nnotify-keyspace-events &quot;&quot;\nhash-max-ziplist-entries 512\nhash-max-ziplist-value 64\nlist-max-ziplist-size -2\nlist-compress-depth 0\nset-max-intset-entries 512\nzset-max-ziplist-entries 128\nzset-max-ziplist-value 64\nhll-sparse-max-bytes 3000\nstream-node-max-bytes 4096\nstream-node-max-entries 100\nactiverehashing yes\nclient-output-buffer-limit normal 0 0 0\nclient-output-buffer-limit replica 256mb 64mb 60\nclient-output-buffer-limit pubsub 32mb 8mb 60\nhz 10\ndynamic-hz yes\naof-rewrite-incremental-fsync yes\nrdb-save-incremental-fsync yes\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br></div></div>',30),t={render:function(s,n){const a=(0,e.up)("OutboundLink");return(0,e.wg)(),(0,e.iD)(e.HY,null,[p,(0,e._)("p",null,[l,(0,e._)("a",r,[c,(0,e.Wm)(a)])]),i],64)}}}}]);