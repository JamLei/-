"use strict";(self.webpackChunkjava_note_vuepress2=self.webpackChunkjava_note_vuepress2||[]).push([[2049],{9528:(s,n,a)=>{a.r(n),a.d(n,{data:()=>e});const e={key:"v-86586fee",path:"/docker-install/03-es.html",title:"Docker ElasticSearch",lang:"zh-CN",frontmatter:{},excerpt:"",headers:[{level:2,title:"安装及测试",slug:"安装及测试",children:[]},{level:2,title:"容器中的配置文件和数据的存储",slug:"容器中的配置文件和数据的存储",children:[]},{level:2,title:"配置与挂载",slug:"配置与挂载",children:[]},{level:2,title:"通过 docker-compose 启动",slug:"通过-docker-compose-启动",children:[]},{level:2,title:"Kibana",slug:"kibana",children:[{level:3,title:"下载 Kibana 镜像",slug:"下载-kibana-镜像",children:[]}]}],filePathRelative:"docker-install/03-es.md",git:{updatedTime:1629711344e3,contributors:[{name:"hemiao",email:"hemiao3000@126.com",commits:1}]}}},25233:(s,n,a)=>{a.r(n),a.d(n,{default:()=>u});var e=a(66252);const p=(0,e._)("h1",{id:"docker-elasticsearch",tabindex:"-1"},[(0,e._)("a",{class:"header-anchor",href:"#docker-elasticsearch","aria-hidden":"true"},"#"),(0,e.Uk)(" Docker ElasticSearch")],-1),t=(0,e.Uk)("docker hub 的 "),l={href:"https://hub.docker.com/_/elasticsearch",target:"_blank",rel:"noopener noreferrer"},c=(0,e._)("em",null,"https://hub.docker.com/_/elasticsearch",-1),o=(0,e.Uk)(" 。"),r=(0,e.uE)('<p>当前<small>（2021-04-02）</small>的 7 版本最新的是 <strong>7.12.0</strong> ，6 版本最新的是 <strong>6.8.15</strong>。<small>（没有 <strong>latest</strong> 版本）</small></p><div class="custom-container warning"><p class="custom-container-title">WARNING</p><p>支持 Window 7 操作系统的最后一个 es 版本是 <strong>7.10.2</strong>，<small>再高你就要换系统了。</small> 但是 docker 镜像里只有 <strong>7.10.1</strong> 版本。</p></div><h2 id="安装及测试" tabindex="-1"><a class="header-anchor" href="#安装及测试" aria-hidden="true">#</a> 安装及测试</h2><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 查询中央仓库</span>\ndocker search -f is-official<span class="token operator">=</span>true elasticsearch\n\n<span class="token comment"># 从中央仓库下载</span>\ndocker pull elasticsearch:7.11.1\n\n<span class="token comment"># 或，直接导入已有的镜像文件</span>\n<span class="token comment"># docker load -i elasticsearch-7.11.1.tar</span>\n\n<span class="token comment"># 查看本地镜像</span>\ndocker images\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>会出现类似以下内容：</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>REPOSITORY      TAG       IMAGE ID       CREATED        SIZE\nelasticsearch   <span class="token number">7.11</span>.1    bc3d45eba361   <span class="token number">6</span> weeks ago    819MB\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>运行容器：</p><ul><li><p>删除曾经已有的同名容器</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>docker stop es-test\ndocker <span class="token function">rm</span> es-test\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li><li><p>创建并运行 elasticsearch 容器的语法</p><p>docker 运行 elasticsearch 时，有可能会报如下错误：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>max virtual memory areas vm.max_map_count [65530] is too low, increase to at least [262144]\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>解决办法是：在 <code>/etc/sysctl.conf</code> 文件最后添加一行：<code>vm.max_map_count=262144</code> 后执行命令 <code>sysctl -p</code> 。</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token builtin class-name">echo</span> <span class="token string">&quot;vm.max_map_count=262144&quot;</span> <span class="token operator">&gt;&gt;</span> /etc/sysctl.conf\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>运行 es</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>docker run <span class="token punctuation">\\</span>\n  -d <span class="token punctuation">\\</span>\n  --name <span class="token operator">&lt;</span>指定容器名<span class="token operator">&gt;</span> <span class="token punctuation">\\</span>\n  -p <span class="token operator">&lt;</span>指定宿主机端口<span class="token operator">&gt;</span>:9200 <span class="token punctuation">\\</span>\n  -p <span class="token operator">&lt;</span>指定宿主机端口<span class="token operator">&gt;</span>:9300 <span class="token punctuation">\\</span>\n  -e <span class="token string">&quot;discovery.type=single-node&quot;</span> <span class="token punctuation">\\</span>\n  -e <span class="token assign-left variable">ES_JAVA_OPTS</span><span class="token operator">=</span><span class="token string">&quot;-Xms256m -Xmx256m&quot;</span> <span class="token punctuation">\\</span>\n  elasticsearch:7.11.1\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><strong>-e &quot;discovery.type=single-node&quot;</strong>：表示单节点运行。</p><p><strong>-e ES_JAVA_OPTS=&quot;-Xms256m -Xmx256m&quot;</strong>：设置初始内存和最大内存。</p><p>例如：</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>docker run <span class="token punctuation">\\</span>\n  -d <span class="token punctuation">\\</span>\n  --name es-test <span class="token punctuation">\\</span>\n  -p <span class="token number">9200</span>:9200 <span class="token punctuation">\\</span>\n  -p <span class="token number">9300</span>:9300 <span class="token punctuation">\\</span>\n  -e <span class="token string">&quot;discovery.type=single-node&quot;</span> <span class="token punctuation">\\</span>\n  -e <span class="token assign-left variable">ES_JAVA_OPTS</span><span class="token operator">=</span><span class="token string">&quot;-Xms256m -Xmx256m&quot;</span> <span class="token punctuation">\\</span>\n  elasticsearch:7.11.1\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div></li></ul><p>验证安装成功</p><ul><li><p>通过 <strong>docker ps</strong> 查看容器的运行信息：</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>docker <span class="token function">ps</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>会看到类似如下信息：</p><p>略</p></li><li><p>访问网址 <code>http://主机IP:9200/</code>，<small>会有一点点延迟，</small>会看到类似如下内容:</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>\n  <span class="token property">&quot;name&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;dc1ef18d9e47&quot;</span><span class="token punctuation">,</span>\n  <span class="token property">&quot;cluster_name&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;docker-cluster&quot;</span><span class="token punctuation">,</span>\n  <span class="token property">&quot;cluster_uuid&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;j99YYT-CRISTsoxgXEB6MA&quot;</span><span class="token punctuation">,</span>\n  <span class="token property">&quot;version&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>\n    <span class="token property">&quot;number&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;6.8.5&quot;</span><span class="token punctuation">,</span>\n    <span class="token property">&quot;build_flavor&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;default&quot;</span><span class="token punctuation">,</span>\n    <span class="token property">&quot;build_type&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;docker&quot;</span><span class="token punctuation">,</span>\n    <span class="token property">&quot;build_hash&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;2f90bbf7b93631e52bafb59b3b049cb44ec25e96&quot;</span><span class="token punctuation">,</span>\n    <span class="token property">&quot;build_date&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;2019-10-28T20:40:44.881551Z&quot;</span><span class="token punctuation">,</span>\n    <span class="token property">&quot;build_snapshot&quot;</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>\n    <span class="token property">&quot;lucene_version&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;8.2.0&quot;</span><span class="token punctuation">,</span>\n    <span class="token property">&quot;minimum_wire_compatibility_version&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;6.8.0&quot;</span><span class="token punctuation">,</span>\n    <span class="token property">&quot;minimum_index_compatibility_version&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;6.0.0-beta1&quot;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token property">&quot;tagline&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;You Know, for Search&quot;</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div></li></ul><h2 id="容器中的配置文件和数据的存储" tabindex="-1"><a class="header-anchor" href="#容器中的配置文件和数据的存储" aria-hidden="true">#</a> 容器中的配置文件和数据的存储</h2><p>Docker ES Server 的配置文件是容器内部：</p><pre><code>/usr/share/elasticsearch/config/elasticsearch.yml\n</code></pre><p>该配置文件的内容只有 2 行：</p><pre><code>cluster.name: &quot;docker-cluster&quot;\nnetwork.host: 0.0.0.0\n</code></pre><p>Docker ES Server 的数据的存储目录是容器内部：</p><pre><code>/usr/share/elasticsearch/data\n</code></pre><h2 id="配置与挂载" tabindex="-1"><a class="header-anchor" href="#配置与挂载" aria-hidden="true">#</a> 配置与挂载</h2><ul><li><p>删除曾经已有的同名容器</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>docker stop es-9200\ndocker <span class="token function">rm</span> es-9200\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>后续可通过 <em>docker run</em> 的 <strong>--rm</strong> 选项免去『删除』这步操作。</p></li><li><p>创建本机挂载目录</p><p>注意，要未</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">mkdir</span> -p ~/docker/9200/data\n<span class="token function">touch</span> ~/docker/9200/config/elasticsearch.yml\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li><li><p>创建并运行容器</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>docker run <span class="token punctuation">\\</span>\n  -d <span class="token punctuation">\\</span>\n  --rm <span class="token punctuation">\\</span>\n  --name es-9200 <span class="token punctuation">\\</span>\n  -p <span class="token number">9200</span>:9200 <span class="token punctuation">\\</span>\n  -p <span class="token number">9300</span>:9300 <span class="token punctuation">\\</span>\n  -v ~/docker/9200/config/elasticsearch.yml:/usr/share/elasticsearch/config/elasticsearch.yml <span class="token punctuation">\\</span>\n  -v ~/docker/9200/data:/usr/share/elasticsearch/data <span class="token punctuation">\\</span>\n  -v ~/docker/9200/plugins:/usr/share/elasticsearch/plugins <span class="token punctuation">\\</span>\n  -e <span class="token string">&quot;discovery.type=single-node&quot;</span> <span class="token punctuation">\\</span>\n  -e <span class="token assign-left variable">ES_JAVA_OPTS</span><span class="token operator">=</span><span class="token string">&quot;-Xms256m -Xmx256m&quot;</span> <span class="token punctuation">\\</span>\n  elasticsearch:7.11.1\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div></li></ul><h2 id="通过-docker-compose-启动" tabindex="-1"><a class="header-anchor" href="#通过-docker-compose-启动" aria-hidden="true">#</a> 通过 docker-compose 启动</h2><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">&#39;3&#39;</span>\n\n<span class="token key atrule">services</span><span class="token punctuation">:</span>\n  <span class="token key atrule">elasticsearch</span><span class="token punctuation">:</span>\n    <span class="token key atrule">image</span><span class="token punctuation">:</span> elasticsearch<span class="token punctuation">:</span>7.11.1\n    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> es\n    <span class="token key atrule">environment</span><span class="token punctuation">:</span>\n      <span class="token punctuation">-</span> <span class="token key atrule">discovery.type</span><span class="token punctuation">:</span> single<span class="token punctuation">-</span>node\n      <span class="token punctuation">-</span> <span class="token key atrule">ES_JAVA_OPTS</span><span class="token punctuation">:</span> <span class="token string">&quot;-Xms512m -Xmx512m&quot;</span>\n    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>\n      <span class="token punctuation">-</span> ./9200/config/elasticsearch.yml<span class="token punctuation">:</span>/usr/share/elasticsearch/config/elasticsearch.yml\n      <span class="token punctuation">-</span> ./9200/data<span class="token punctuation">:</span>/usr/share/elasticsearch/data\n      <span class="token punctuation">-</span> ./9200/plugins<span class="token punctuation">:</span>/usr/share/elasticsearch/plugins\n    <span class="token key atrule">ports</span><span class="token punctuation">:</span>\n      <span class="token punctuation">-</span> <span class="token string">&quot;9200:9200&quot;</span>\n      <span class="token punctuation">-</span> <span class="token string">&quot;9300:9300&quot;</span>\n    <span class="token key atrule">networks</span><span class="token punctuation">:</span>\n      <span class="token punctuation">-</span> elastic\n  <span class="token key atrule">kibana</span><span class="token punctuation">:</span>\n    <span class="token key atrule">image</span><span class="token punctuation">:</span> kibana<span class="token punctuation">:</span>7.11.1\n    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> kib\n    <span class="token key atrule">ports</span><span class="token punctuation">:</span>\n      <span class="token punctuation">-</span> <span class="token string">&quot;5601:5601&quot;</span>\n    <span class="token key atrule">depends_on</span><span class="token punctuation">:</span>\n      <span class="token punctuation">-</span> elasticsearch\n    <span class="token key atrule">networks</span><span class="token punctuation">:</span>\n      <span class="token punctuation">-</span> elastic\n<span class="token key atrule">networks</span><span class="token punctuation">:</span>\n  <span class="token key atrule">elastic</span><span class="token punctuation">:</span>\n    <span class="token key atrule">driver</span><span class="token punctuation">:</span> bridge\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><h2 id="kibana" tabindex="-1"><a class="header-anchor" href="#kibana" aria-hidden="true">#</a> Kibana</h2><h3 id="下载-kibana-镜像" tabindex="-1"><a class="header-anchor" href="#下载-kibana-镜像" aria-hidden="true">#</a> 下载 Kibana 镜像</h3><p>注意，Kibana 的版本需要与 ElasticSearch 保持一致。</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>docker pull kibana:7.11.1\n\n<span class="token comment"># 或，直接导入已有的镜像文件</span>\n<span class="token comment"># docker load -i kibana-7.11.1.tar</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>之前要安装 elasticsearch 时，需要创建一个网络，目的是为了让 ElasticSearch 和 Kibana 在同一个网络中：</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>docker network create es-network\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>运行 Kibana</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>docker run <span class="token punctuation">\\</span>\n    -d <span class="token punctuation">\\</span>\n    --name kibana <span class="token punctuation">\\</span>\n    --net es-network <span class="token punctuation">\\</span>\n    -p <span class="token number">5601</span>:5601 <span class="token punctuation">\\</span>\n    kibana:7.11.1\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>通过浏览器访问：<code>http://host-ip:5601</code> 。</p>',30),u={render:function(s,n){const a=(0,e.up)("OutboundLink");return(0,e.wg)(),(0,e.iD)(e.HY,null,[p,(0,e._)("p",null,[t,(0,e._)("a",l,[c,(0,e.Wm)(a)]),o]),r],64)}}}}]);