<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.24">
    <title>Spring Boot 整合 RabbitMQ | hemiao3000</title><meta name="description" content="Java Note All in One">
    <link rel="preload" href="/assets/js/runtime~app.98b3ec54.js" as="script"><link rel="preload" href="/assets/css/styles.a89f47c6.css" as="style"><link rel="preload" href="/assets/js/1812.d943ba23.js" as="script"><link rel="preload" href="/assets/js/app.305f9df9.js" as="script">
    <link rel="stylesheet" href="/assets/css/styles.a89f47c6.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/" class=""><!----><span class="site-name">hemiao3000</span></a></span><div class="navbar-links-wrapper" style=""><!--[--><!--]--><nav class="navbar-links can-hide"><!--[--><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="环境软件和模板"><span class="title">环境软件和模板</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="环境软件和模板"><span class="title">环境软件和模板</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/windows/01-IDEA.md" class="nav-link" aria-label="Windows"><!--[--><!--]--> Windows <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/linux/00-预备知识.md" class="nav-link" aria-label="Linux"><!--[--><!--]--> Linux <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/git/000-安装与配置.md" class="nav-link" aria-label="Git"><!--[--><!--]--> Git <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/docker/01-简介和安装.md" class="nav-link" aria-label="Docker"><!--[--><!--]--> Docker <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/docker-install/01-mysql.md" class="nav-link" aria-label="Docker 安装软件"><!--[--><!--]--> Docker 安装软件 <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/gist/01-jdbc-logback.md" class="nav-link" aria-label="各种模板"><!--[--><!--]--> 各种模板 <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="第一阶段"><span class="title">第一阶段</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="第一阶段"><span class="title">第一阶段</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><!--[--><h4 class="dropdown-subtitle"><span>基础</span></h4><ul class="dropdown-subitem-wrapper"><!--[--><li class="dropdown-subitem"><a href="/java/00-环境变量.md" class="nav-link" aria-label="Java"><!--[--><!--]--> Java <!--[--><!--]--></a></li><li class="dropdown-subitem"><a href="/mysql/01-操作Database.md" class="nav-link" aria-label="MySQL 数据库"><!--[--><!--]--> MySQL 数据库 <!--[--><!--]--></a></li><li class="dropdown-subitem"><a href="/jdbc/01-JDBC基础.md" class="nav-link" aria-label="JDBC 操作数据库"><!--[--><!--]--> JDBC 操作数据库 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="dropdown-item"><!--[--><h4 class="dropdown-subtitle"><span>进阶</span></h4><ul class="dropdown-subitem-wrapper"><!--[--><li class="dropdown-subitem"><a href="/java-thread/thread-01-base.md" class="nav-link" aria-label="Java 多线程"><!--[--><!--]--> Java 多线程 <!--[--><!--]--></a></li><li class="dropdown-subitem"><a href="/java8/02-lambda.md" class="nav-link" aria-label="JDK8 新特性"><!--[--><!--]--> JDK8 新特性 <!--[--><!--]--></a></li><li class="dropdown-subitem"><a href="/utility/guava/01-字符串工具类.md" class="nav-link" aria-label="Guava 工具库"><!--[--><!--]--> Guava 工具库 <!--[--><!--]--></a></li><li class="dropdown-subitem"><a href="/utility/spring-utils/01-top4.md" class="nav-link" aria-label="Spring 内置工具库"><!--[--><!--]--> Spring 内置工具库 <!--[--><!--]--></a></li><li class="dropdown-subitem"><a href="/utility/3rd/01-slf4j.md" class="nav-link" aria-label="其它工具库"><!--[--><!--]--> 其它工具库 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="dropdown-item"><!--[--><h4 class="dropdown-subtitle"><span>扩展</span></h4><ul class="dropdown-subitem-wrapper"><!--[--><li class="dropdown-subitem"><a href="/jvm/01-JVM内存布局.md" class="nav-link" aria-label="Java 虚拟机"><!--[--><!--]--> Java 虚拟机 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul><!--]--></div></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="第二阶段"><span class="title">第二阶段</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="第二阶段"><span class="title">第二阶段</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><!--[--><h4 class="dropdown-subtitle"><span>前端基础</span></h4><ul class="dropdown-subitem-wrapper"><!--[--><li class="dropdown-subitem"><a href="/html/01-基本概念和结构.md" class="nav-link" aria-label="HTML"><!--[--><!--]--> HTML <!--[--><!--]--></a></li><li class="dropdown-subitem"><a href="/css/01-基本概念.md" class="nav-link" aria-label="CSS"><!--[--><!--]--> CSS <!--[--><!--]--></a></li><li class="dropdown-subitem"><a href="/js/JS-01-基础.md" class="nav-link" aria-label="JavaScript"><!--[--><!--]--> JavaScript <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="dropdown-item"><a href="/servlet/Servlet-00-HTTP概述.md" class="nav-link" aria-label="Servlet"><!--[--><!--]--> Servlet <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/junit/JUnit-01-基础.md" class="nav-link" aria-label="JUnit"><!--[--><!--]--> JUnit <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/mybatis/01-mybatis-basics.md" class="nav-link" aria-label="Mybatis"><!--[--><!--]--> Mybatis <!--[--><!--]--></a></li><li class="dropdown-item"><!--[--><h4 class="dropdown-subtitle"><span>前端进阶</span></h4><ul class="dropdown-subitem-wrapper"><!--[--><li class="dropdown-subitem"><a href="/ajax/01-基础.md" class="nav-link" aria-label="AJAX 请求及相关"><!--[--><!--]--> AJAX 请求及相关 <!--[--><!--]--></a></li><li class="dropdown-subitem"><a href="/vue/vue-00-devtool.md" class="nav-link" aria-label="Vue（上）"><!--[--><!--]--> Vue（上） <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul><!--]--></div></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="第三阶段"><span class="title">第三阶段</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="第三阶段"><span class="title">第三阶段</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><!--[--><h4 class="dropdown-subtitle"><span>SSM</span></h4><ul class="dropdown-subitem-wrapper"><!--[--><li class="dropdown-subitem"><a href="/maven/001-基本概念.md" class="nav-link" aria-label="Maven"><!--[--><!--]--> Maven <!--[--><!--]--></a></li><li class="dropdown-subitem"><a href="/spring/01-IoC.md" class="nav-link" aria-label="Spring"><!--[--><!--]--> Spring <!--[--><!--]--></a></li><li class="dropdown-subitem"><a href="/spring-mvc/001-helloworld.md" class="nav-link" aria-label="Spring MVC"><!--[--><!--]--> Spring MVC <!--[--><!--]--></a></li><li class="dropdown-subitem"><a href="/spring-boot/02-Java代码配置.md" class="nav-link" aria-label="Spring Boot"><!--[--><!--]--> Spring Boot <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="dropdown-item"><!--[--><h4 class="dropdown-subtitle"><span>前端高级</span></h4><ul class="dropdown-subitem-wrapper"><!--[--><li class="dropdown-subitem"><a href="/restful/01-基础.md" class="nav-link" aria-label="RESTful API"><!--[--><!--]--> RESTful API <!--[--><!--]--></a></li><li class="dropdown-subitem"><a href="/vue-cli/vue-cli-01.md" class="nav-link" aria-label="Vue（下）"><!--[--><!--]--> Vue（下） <!--[--><!--]--></a></li><li class="dropdown-subitem"><a href="/nginx/01-前后端分离.md" class="nav-link" aria-label="Nginx"><!--[--><!--]--> Nginx <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="dropdown-item"><!--[--><h4 class="dropdown-subtitle"><span>权限和其它</span></h4><ul class="dropdown-subitem-wrapper"><!--[--><li class="dropdown-subitem"><a href="/shiro/01-Shiro-基础.md" class="nav-link" aria-label="Shiro"><!--[--><!--]--> Shiro <!--[--><!--]--></a></li><li class="dropdown-subitem"><a href="/redis/01-简介.md" class="nav-link" aria-label="Redis"><!--[--><!--]--> Redis <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul><!--]--></div></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="第四阶段"><span class="title">第四阶段</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="第四阶段"><span class="title">第四阶段</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/spring-cloud/01-spring-cloud.md" class="nav-link" aria-label="Spring Cloud"><!--[--><!--]--> Spring Cloud <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/rabbitmq/01-简介.md" class="nav-link" aria-label="RabbitMQ"><!--[--><!--]--> RabbitMQ <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/es/00-素材.md" class="nav-link" aria-label="ElasticSearch"><!--[--><!--]--> ElasticSearch <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/other/01-SnowFlake.md" class="nav-link" aria-label="其它"><!--[--><!--]--> 其它 <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><!--]--></nav><!--[--><!--]--><button class="toggle-dark-button" title="toggle dark mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><div class="sidebar-mask"></div><aside class="sidebar"><nav class="navbar-links"><!--[--><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="环境软件和模板"><span class="title">环境软件和模板</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="环境软件和模板"><span class="title">环境软件和模板</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/windows/01-IDEA.md" class="nav-link" aria-label="Windows"><!--[--><!--]--> Windows <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/linux/00-预备知识.md" class="nav-link" aria-label="Linux"><!--[--><!--]--> Linux <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/git/000-安装与配置.md" class="nav-link" aria-label="Git"><!--[--><!--]--> Git <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/docker/01-简介和安装.md" class="nav-link" aria-label="Docker"><!--[--><!--]--> Docker <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/docker-install/01-mysql.md" class="nav-link" aria-label="Docker 安装软件"><!--[--><!--]--> Docker 安装软件 <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/gist/01-jdbc-logback.md" class="nav-link" aria-label="各种模板"><!--[--><!--]--> 各种模板 <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="第一阶段"><span class="title">第一阶段</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="第一阶段"><span class="title">第一阶段</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><!--[--><h4 class="dropdown-subtitle"><span>基础</span></h4><ul class="dropdown-subitem-wrapper"><!--[--><li class="dropdown-subitem"><a href="/java/00-环境变量.md" class="nav-link" aria-label="Java"><!--[--><!--]--> Java <!--[--><!--]--></a></li><li class="dropdown-subitem"><a href="/mysql/01-操作Database.md" class="nav-link" aria-label="MySQL 数据库"><!--[--><!--]--> MySQL 数据库 <!--[--><!--]--></a></li><li class="dropdown-subitem"><a href="/jdbc/01-JDBC基础.md" class="nav-link" aria-label="JDBC 操作数据库"><!--[--><!--]--> JDBC 操作数据库 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="dropdown-item"><!--[--><h4 class="dropdown-subtitle"><span>进阶</span></h4><ul class="dropdown-subitem-wrapper"><!--[--><li class="dropdown-subitem"><a href="/java-thread/thread-01-base.md" class="nav-link" aria-label="Java 多线程"><!--[--><!--]--> Java 多线程 <!--[--><!--]--></a></li><li class="dropdown-subitem"><a href="/java8/02-lambda.md" class="nav-link" aria-label="JDK8 新特性"><!--[--><!--]--> JDK8 新特性 <!--[--><!--]--></a></li><li class="dropdown-subitem"><a href="/utility/guava/01-字符串工具类.md" class="nav-link" aria-label="Guava 工具库"><!--[--><!--]--> Guava 工具库 <!--[--><!--]--></a></li><li class="dropdown-subitem"><a href="/utility/spring-utils/01-top4.md" class="nav-link" aria-label="Spring 内置工具库"><!--[--><!--]--> Spring 内置工具库 <!--[--><!--]--></a></li><li class="dropdown-subitem"><a href="/utility/3rd/01-slf4j.md" class="nav-link" aria-label="其它工具库"><!--[--><!--]--> 其它工具库 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="dropdown-item"><!--[--><h4 class="dropdown-subtitle"><span>扩展</span></h4><ul class="dropdown-subitem-wrapper"><!--[--><li class="dropdown-subitem"><a href="/jvm/01-JVM内存布局.md" class="nav-link" aria-label="Java 虚拟机"><!--[--><!--]--> Java 虚拟机 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul><!--]--></div></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="第二阶段"><span class="title">第二阶段</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="第二阶段"><span class="title">第二阶段</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><!--[--><h4 class="dropdown-subtitle"><span>前端基础</span></h4><ul class="dropdown-subitem-wrapper"><!--[--><li class="dropdown-subitem"><a href="/html/01-基本概念和结构.md" class="nav-link" aria-label="HTML"><!--[--><!--]--> HTML <!--[--><!--]--></a></li><li class="dropdown-subitem"><a href="/css/01-基本概念.md" class="nav-link" aria-label="CSS"><!--[--><!--]--> CSS <!--[--><!--]--></a></li><li class="dropdown-subitem"><a href="/js/JS-01-基础.md" class="nav-link" aria-label="JavaScript"><!--[--><!--]--> JavaScript <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="dropdown-item"><a href="/servlet/Servlet-00-HTTP概述.md" class="nav-link" aria-label="Servlet"><!--[--><!--]--> Servlet <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/junit/JUnit-01-基础.md" class="nav-link" aria-label="JUnit"><!--[--><!--]--> JUnit <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/mybatis/01-mybatis-basics.md" class="nav-link" aria-label="Mybatis"><!--[--><!--]--> Mybatis <!--[--><!--]--></a></li><li class="dropdown-item"><!--[--><h4 class="dropdown-subtitle"><span>前端进阶</span></h4><ul class="dropdown-subitem-wrapper"><!--[--><li class="dropdown-subitem"><a href="/ajax/01-基础.md" class="nav-link" aria-label="AJAX 请求及相关"><!--[--><!--]--> AJAX 请求及相关 <!--[--><!--]--></a></li><li class="dropdown-subitem"><a href="/vue/vue-00-devtool.md" class="nav-link" aria-label="Vue（上）"><!--[--><!--]--> Vue（上） <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul><!--]--></div></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="第三阶段"><span class="title">第三阶段</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="第三阶段"><span class="title">第三阶段</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><!--[--><h4 class="dropdown-subtitle"><span>SSM</span></h4><ul class="dropdown-subitem-wrapper"><!--[--><li class="dropdown-subitem"><a href="/maven/001-基本概念.md" class="nav-link" aria-label="Maven"><!--[--><!--]--> Maven <!--[--><!--]--></a></li><li class="dropdown-subitem"><a href="/spring/01-IoC.md" class="nav-link" aria-label="Spring"><!--[--><!--]--> Spring <!--[--><!--]--></a></li><li class="dropdown-subitem"><a href="/spring-mvc/001-helloworld.md" class="nav-link" aria-label="Spring MVC"><!--[--><!--]--> Spring MVC <!--[--><!--]--></a></li><li class="dropdown-subitem"><a href="/spring-boot/02-Java代码配置.md" class="nav-link" aria-label="Spring Boot"><!--[--><!--]--> Spring Boot <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="dropdown-item"><!--[--><h4 class="dropdown-subtitle"><span>前端高级</span></h4><ul class="dropdown-subitem-wrapper"><!--[--><li class="dropdown-subitem"><a href="/restful/01-基础.md" class="nav-link" aria-label="RESTful API"><!--[--><!--]--> RESTful API <!--[--><!--]--></a></li><li class="dropdown-subitem"><a href="/vue-cli/vue-cli-01.md" class="nav-link" aria-label="Vue（下）"><!--[--><!--]--> Vue（下） <!--[--><!--]--></a></li><li class="dropdown-subitem"><a href="/nginx/01-前后端分离.md" class="nav-link" aria-label="Nginx"><!--[--><!--]--> Nginx <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="dropdown-item"><!--[--><h4 class="dropdown-subtitle"><span>权限和其它</span></h4><ul class="dropdown-subitem-wrapper"><!--[--><li class="dropdown-subitem"><a href="/shiro/01-Shiro-基础.md" class="nav-link" aria-label="Shiro"><!--[--><!--]--> Shiro <!--[--><!--]--></a></li><li class="dropdown-subitem"><a href="/redis/01-简介.md" class="nav-link" aria-label="Redis"><!--[--><!--]--> Redis <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul><!--]--></div></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="第四阶段"><span class="title">第四阶段</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="第四阶段"><span class="title">第四阶段</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/spring-cloud/01-spring-cloud.md" class="nav-link" aria-label="Spring Cloud"><!--[--><!--]--> Spring Cloud <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/rabbitmq/01-简介.md" class="nav-link" aria-label="RabbitMQ"><!--[--><!--]--> RabbitMQ <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/es/00-素材.md" class="nav-link" aria-label="ElasticSearch"><!--[--><!--]--> ElasticSearch <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/other/01-SnowFlake.md" class="nav-link" aria-label="其它"><!--[--><!--]--> 其它 <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-links"><!--[--><!--[--><p class="sidebar-heading sidebar-item active">RabbitMQ</p><ul class=""><li><!--[--><a href="/rabbitmq/01-%E7%AE%80%E4%BB%8B.html" class="nav-link sidebar-item" aria-label="RabbitMQ 简介"><!--[--><!--]--> RabbitMQ 简介 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/rabbitmq/02-spring-boot.html" class="router-link-active router-link-exact-active nav-link router-link-active sidebar-item active" aria-label="Spring Boot 整合 RabbitMQ"><!--[--><!--]--> Spring Boot 整合 RabbitMQ <!--[--><!--]--></a><ul class="sidebar-sub-items"><li><!--[--><a aria-current="page" href="/rabbitmq/02-spring-boot.html#_01-pom-xml" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="01. pom.xml"><!--[--><!--]--> 01. pom.xml <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/rabbitmq/02-spring-boot.html#_02-配置文件" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="02. 配置文件"><!--[--><!--]--> 02. 配置文件 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/rabbitmq/02-spring-boot.html#_03-简单示例" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="03. 简单示例"><!--[--><!--]--> 03. 简单示例 <!--[--><!--]--></a><ul class="sidebar-sub-items"><li><!--[--><a aria-current="page" href="/rabbitmq/02-spring-boot.html#_03-1-定义队列" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="03.1 定义队列"><!--[--><!--]--> 03.1 定义队列 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/rabbitmq/02-spring-boot.html#_03-2-定义消息接收者-消费者" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="03.2 定义消息接收者/消费者"><!--[--><!--]--> 03.2 定义消息接收者/消费者 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/rabbitmq/02-spring-boot.html#_03-3-发送消息-测试并验证" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="03.3 发送消息（测试并验证）"><!--[--><!--]--> 03.3 发送消息（测试并验证） <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li><li><!--[--><a aria-current="page" href="/rabbitmq/02-spring-boot.html#_04-创建-exchange、queue-和-binding" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="04. 创建 Exchange、Queue 和 Binding"><!--[--><!--]--> 04. 创建 Exchange、Queue 和 Binding <!--[--><!--]--></a><ul class="sidebar-sub-items"><li><!--[--><a aria-current="page" href="/rabbitmq/02-spring-boot.html#_04-a-创建-exchange" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="04.a 创建 Exchange"><!--[--><!--]--> 04.a 创建 Exchange <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/rabbitmq/02-spring-boot.html#_04-b-创建-queue" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="04.b 创建 Queue"><!--[--><!--]--> 04.b 创建 Queue <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/rabbitmq/02-spring-boot.html#_04-c-创建-binding" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="04.c 创建 Binding"><!--[--><!--]--> 04.c 创建 Binding <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li><li><!--[--><a aria-current="page" href="/rabbitmq/02-spring-boot.html#_05-发送消息" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="05. 发送消息"><!--[--><!--]--> 05. 发送消息 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/rabbitmq/02-spring-boot.html#_06-接收-消费消息-push-型" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="06. 接收/消费消息（PUSH 型）"><!--[--><!--]--> 06. 接收/消费消息（PUSH 型） <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/rabbitmq/02-spring-boot.html#_07-对象的支持" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="07. 对象的支持"><!--[--><!--]--> 07. 对象的支持 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/rabbitmq/02-spring-boot.html#_08-topic-exchange" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="08. Topic Exchange"><!--[--><!--]--> 08. Topic Exchange <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/rabbitmq/02-spring-boot.html#_09-fanout-exchange" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="09. Fanout Exchange"><!--[--><!--]--> 09. Fanout Exchange <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/rabbitmq/02-spring-boot.html#_10-接收-消费消息-pull-型" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="10. 接收/消费消息（PULL 型）"><!--[--><!--]--> 10. 接收/消费消息（PULL 型） <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/rabbitmq/02-spring-boot.html#_11-发送者确认" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="11. 发送者确认"><!--[--><!--]--> 11. 发送者确认 <!--[--><!--]--></a><ul class="sidebar-sub-items"><li><!--[--><a aria-current="page" href="/rabbitmq/02-spring-boot.html#_11-a-确认消息已到-exchange" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="11.a 确认消息已到 Exchange"><!--[--><!--]--> 11.a 确认消息已到 Exchange <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/rabbitmq/02-spring-boot.html#_11-b-确认消息已到-message-queue" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="11.b 确认消息已到 Message Queue"><!--[--><!--]--> 11.b 确认消息已到 Message Queue <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li><li><!--[--><a aria-current="page" href="/rabbitmq/02-spring-boot.html#_12-消费端的确认与拒绝" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="12. 消费端的确认与拒绝"><!--[--><!--]--> 12. 消费端的确认与拒绝 <!--[--><!--]--></a><ul class="sidebar-sub-items"><li><!--[--><a aria-current="page" href="/rabbitmq/02-spring-boot.html#_12-1-确认消息" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="12.1 确认消息"><!--[--><!--]--> 12.1 确认消息 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/rabbitmq/02-spring-boot.html#_12-2-拒绝消息" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="12.2 拒绝消息"><!--[--><!--]--> 12.2 拒绝消息 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li></ul><!--]--></li><li><!--[--><a href="/rabbitmq/03-%E6%AD%BB%E4%BF%A1%E9%98%9F%E5%88%97.html" class="nav-link sidebar-item" aria-label="延迟队列"><!--[--><!--]--> 延迟队列 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/rabbitmq/04-%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1.html" class="nav-link sidebar-item" aria-label="基于 RabbitMQ 的最终一致性分布式事务"><!--[--><!--]--> 基于 RabbitMQ 的最终一致性分布式事务 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--><!--]--></ul><!--[--><!--]--></aside><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><h1 id="spring-boot-整合-rabbitmq" tabindex="-1"><a class="header-anchor" href="#spring-boot-整合-rabbitmq" aria-hidden="true">#</a> Spring Boot 整合 RabbitMQ</h1><p>Spring Boot 提供了 <strong>spring-boot-starter-amqp</strong> 组件对实现了 AMQP 协议的消息队列<small>（RabbitMQ）</small>的快速整合。</p><h2 id="_01-pom-xml" tabindex="-1"><a class="header-anchor" href="#_01-pom-xml" aria-hidden="true">#</a> 01. pom.xml</h2><p><img src="https://hemiao3000.gitee.io/java-note-img/images/rabbitmq/img/spring-boot-rabbitmq-01.png" alt="rabbitmq-01"></p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-amqp<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="_02-配置文件" tabindex="-1"><a class="header-anchor" href="#_02-配置文件" aria-hidden="true">#</a> 02. 配置文件</h2><p>配置 rabbitmq 的安装地址、端口以及账户信息：</p><div class="language-properties ext-properties line-numbers-mode"><pre class="language-properties"><code><span class="token attr-name">spring.application.name</span><span class="token punctuation">=</span><span class="token attr-value">spring-rabbitmq-demo</span>
<span class="token comment">## -----------------------------------------------</span>
<span class="token attr-name">spring.rabbitmq.host</span><span class="token punctuation">=</span><span class="token attr-value">127.0.0.1</span>
<span class="token attr-name">spring.rabbitmq.port</span><span class="token punctuation">=</span><span class="token attr-value">5672</span>
<span class="token attr-name">spring.rabbitmq.username</span><span class="token punctuation">=</span><span class="token attr-value">guest</span>
<span class="token attr-name">spring.rabbitmq.password</span><span class="token punctuation">=</span><span class="token attr-value">guest</span>
<span class="token comment">## -----------------------------------------------</span>
<span class="token attr-name">logging.level.root</span><span class="token punctuation">=</span><span class="token attr-value">INFO</span>
<span class="token attr-name">logging.level.xxx.yyy.zzz</span><span class="token punctuation">=</span><span class="token attr-value">DEBUG</span>
<span class="token attr-name">logging.pattern.console</span><span class="token punctuation">=</span><span class="token attr-value">${CONSOLE_LOG_PATTERN:\
  %clr(${LOG_LEVEL_PATTERN:%5p}) \
  %clr([%15.15t]){faint} \
  %clr(%-40.40logger{39}){cyan} \
  %clr(:){faint} %m%n\
  ${LOG_EXCEPTION_CONVERSION_WORD:%wEx}}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h2 id="_03-简单示例" tabindex="-1"><a class="header-anchor" href="#_03-简单示例" aria-hidden="true">#</a> 03. 简单示例</h2><p>老规矩，使用 <strong>@EnableRabbit</strong> 注解标注于配置类上，以表示使用 RabbitMQ 的注解功能。</p><h3 id="_03-1-定义队列" tabindex="-1"><a class="header-anchor" href="#_03-1-定义队列" aria-hidden="true">#</a> 03.1 定义队列</h3><blockquote><p>虽然我们可以在代码中再定义、创建 Queue，但是通常我们是在 RabbitMQ 的管理台创建好 Queue 之后，再在代码中直接使用。</p></blockquote><p>RabbitMQConfig.java：</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// import org.springframework.amqp.core.Queue;</span>

<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RabbitMQConfig</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">Queue</span> <span class="token function">queue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Queue</span><span class="token punctuation">(</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="_03-2-定义消息接收者-消费者" tabindex="-1"><a class="header-anchor" href="#_03-2-定义消息接收者-消费者" aria-hidden="true">#</a> 03.2 定义消息接收者/消费者</h3><p>HelloReceiver.java</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@RabbitListener</span><span class="token punctuation">(</span>queues <span class="token operator">=</span> <span class="token string">&quot;hello&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloReceiver</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@RabbitHandler</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">process</span><span class="token punctuation">(</span><span class="token class-name">String</span> hello<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;Receiver : {}&quot;</span><span class="token punctuation">,</span> hello<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>注意使用注解 <strong>@RabbitListener</strong> 的 <strong>queues</strong> 属性指明队列名称，<strong>@RabbitHandler</strong> 为具体接收的方法。</p><h3 id="_03-3-发送消息-测试并验证" tabindex="-1"><a class="header-anchor" href="#_03-3-发送消息-测试并验证" aria-hidden="true">#</a> 03.3 发送消息（测试并验证）</h3><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Autowired</span>
<span class="token keyword">private</span> <span class="token class-name">RabbitTemplate</span> rabbitTemplate<span class="token punctuation">;</span>

<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> context <span class="token operator">=</span> <span class="token string">&quot;hello &quot;</span> <span class="token operator">+</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;Sender : {}&quot;</span><span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">;</span>
    rabbitTemplate<span class="token punctuation">.</span><span class="token function">convertAndSend</span><span class="token punctuation">(</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>这是一个最简单的案例。上述的代码种，并未明确涉及到 <strong>Exchange</strong> 的概念，因为这里使用到的是 <strong>Default Exchange</strong> 。</p><p>Default Exchange 的投递规则是：以 <strong>Queue Name</strong> 作为 <strong>Binding Key</strong>。因此，我们在代码中，使用 <em><code>hello</code></em> 作为 Binding Key 时，消息最终被投递到了 hello 队列。</p><blockquote><p>注意，再次强调一下，上述的 <em>hello</em> 本质上不是 queue-name，而是 binding-key 。</p></blockquote><h2 id="_04-创建-exchange、queue-和-binding" tabindex="-1"><a class="header-anchor" href="#_04-创建-exchange、queue-和-binding" aria-hidden="true">#</a> 04. 创建 Exchange、Queue 和 Binding</h2><p>虽然可以，但是还是不建议在代码中去创建 Exchange、Queue 和 Binding。通常还是在 RabbitMQ 中把这些东西都建好，然后再在代码中访问/操作。</p><p><small>其实，这很类似于 Hibernate/JPA 的建表功能。虽然有这种功能存在，但是使用的机会和场景并不多。通常都是现在数据库中把表建好之后直接使用。除非是测试环境中的临时表，才会用到这种功能。</small></p><h3 id="_04-a-创建-exchange" tabindex="-1"><a class="header-anchor" href="#_04-a-创建-exchange" aria-hidden="true">#</a> 04.a 创建 Exchange</h3><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">Exchange</span> <span class="token function">exchange</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token comment">//  return new TopicExchange(&quot;test-exchange-1&quot;); </span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">TopicExchange</span><span class="token punctuation">(</span><span class="token string">&quot;test-exchange-1&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>参数说明：</p><table><thead><tr><th style="text-align:left;">参数</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;">name</td><td style="text-align:left;">字符串值，exchange 的名称。</td></tr><tr><td style="text-align:left;">durable</td><td style="text-align:left;">布尔值，表示该 exchage 是否持久化。<br> 持久化意味着当 RabbitMQ 重启后，该 exchange 是否会恢复/仍存在。</td></tr><tr><td style="text-align:left;">autoDelete</td><td style="text-align:left;">布尔值，表示当该 exchange 没“人”<small>（queue）</small>用时，是否会被自动删除。</td></tr></tbody></table><p>不指定 durable 和 autoDelete 时，默认为 <em><code>true</code></em> 和 <em><code>false</code></em> 。表示持久化、不用自动删除。</p><p><small>补充，这背后调用的是原生 API 中的 <strong><code>Channel</code></strong> 的 <em><code>.exchangeDeclare()</code></em> 方法。</small></p><h3 id="_04-b-创建-queue" tabindex="-1"><a class="header-anchor" href="#_04-b-创建-queue" aria-hidden="true">#</a> 04.b 创建 Queue</h3><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">Queue</span> <span class="token function">queue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token comment">//  return new Queue(&quot;test-queue-1&quot;); </span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Queue</span><span class="token punctuation">(</span><span class="token string">&quot;test-queue-1&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>参数说明：</p><table><thead><tr><th style="text-align:left;">参数</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;">name</td><td style="text-align:left;">字符串值，exchange 的名称。</td></tr><tr><td style="text-align:left;">durable</td><td style="text-align:left;">布尔值，表示该 queue 是否持久化。<br> 持久化意味着当 RabbitMQ 重启后，该 queue 是否会恢复/仍存在。<br>另外，需要注意的是，queue 的持久化不等于其中的消息也会被持久化。</td></tr><tr><td style="text-align:left;">exclusive</td><td style="text-align:left;">布尔值，表示该 queue 是否排它式使用。排它式使用意味着仅声明他的连接可见/可用，其它连接不可见/不可用。</td></tr><tr><td style="text-align:left;">autoDelete</td><td style="text-align:left;">布尔值，表示当该 queue 没“人”<small>（connection）</small>用时，是否会被自动删除。</td></tr></tbody></table><p>不指定 durable、exclusive 和 autoDelete 时，默认为 <em>true</em> 、 <em>false</em> 和 <em>false</em> 。表示持久化、非排它、不用自动删除。</p><p><small>补充，这背后调用的是原生 API 中的 <em>Channel</em> 的 <em>.queueDeclare()</em> 方法。</small></p><h3 id="_04-c-创建-binding" tabindex="-1"><a class="header-anchor" href="#_04-c-创建-binding" aria-hidden="true">#</a> 04.c 创建 Binding</h3><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">Binding</span> <span class="token function">binding</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token class-name">BindingBuilder</span>
        <span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token function">queue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token keyword">to</span><span class="token punctuation">(</span><span class="token function">exchange</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token keyword">with</span><span class="token punctuation">(</span><span class="token string">&quot;*.orange.*&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">noargs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="_05-发送消息" tabindex="-1"><a class="header-anchor" href="#_05-发送消息" aria-hidden="true">#</a> 05. 发送消息</h2><p>spring-rabbit 提供了 RabbitTemplate 来简化原生 API 的消息发送方法。</p><p><small>（最简单的情况下），</small>你可以直接要求 Spring 给你注入一个 <strong>RabbitTemplate</strong>，通过它来发送消息：</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Autowired</span>
<span class="token keyword">private</span> <span class="token class-name">RabbitTemplate</span> rabbitTemplate<span class="token punctuation">;</span>

<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">demo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    rabbitTemplate<span class="token punctuation">.</span><span class="token function">convertAndSend</span><span class="token punctuation">(</span><span class="token string">&quot;queue-demo-1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;hello world&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><strong>.convertAndSend</strong> 方法的第一个参数是 <strong>routing-key</strong>，第二个参数是你所要发送的消息。</p><p>在没有明确指定 Exchange 的情况下，该消息发送给了 RabbitMQ 的 <strong>default-exchange</strong>。而 default-exchage 是将 <strong>routing-key</strong> 视为 queue-name 。</p><p>也就是说，上述代码中的 <strong>routing-key</strong> 是 <em>queue-demo-1</em>，那么该消息最终是发送给 <em>queue-demo-1</em> 队列。</p><p><small><strong>.convertAndSend</strong> 方法是 <strong>.send</strong> 方法的包装/简化。<strong>.send</strong> 方法的调用相对比较繁琐。</small></p><h2 id="_06-接收-消费消息-push-型" tabindex="-1"><a class="header-anchor" href="#_06-接收-消费消息-push-型" aria-hidden="true">#</a> 06. 接收/消费消息（PUSH 型）</h2><p>接收/消费消息的方式有两种：Push 型和 Pull 型。</p><p>Push 型表示由 RabbitMQ Broker 负责将消息推送给消费者。消费者在一开始指定/配置监听哪个队列的消息后，就无需考虑其它。当该队列收到消息后，消费者的指定方法就会被触发执行。</p><p>PUSH 消费的配置非常简单，对你的消费者类标注 <strong>@RabbitListener</strong> 注解，为你的消费方法标注 <strong>@RabbitHandler</strong> 注解即可。当然，前提是消费者类要托管给 Spring：</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@RabbitListener</span><span class="token punctuation">(</span>queues <span class="token operator">=</span> <span class="token string">&quot;queue-demo-1&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Consumer1</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Logger</span> log <span class="token operator">=</span> <span class="token class-name">LoggerFactory</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token class-name">Consumer1</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@RabbitHandler</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">process</span><span class="token punctuation">(</span><span class="token class-name">String</span> message<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;Consumer 1: {}&quot;</span><span class="token punctuation">,</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>甚至，你可以直接将 <strong>@RabbitListener</strong> 标注在方法上，此时，不需要配套使用 <strong>@RabbitHandler</strong> 注解。</p><h2 id="_07-对象的支持" tabindex="-1"><a class="header-anchor" href="#_07-对象的支持" aria-hidden="true">#</a> 07. 对象的支持</h2><p>Spring Boot 已经完美支持对象的发送和接收，不需要额外的配置。不过，需要注意的是所传递的对象需要实现 <strong>Serializable</strong> 接口。</p><p>!声明队列</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">Queue</span> <span class="token function">departmentQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Queue</span><span class="token punctuation">(</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Autowired</span>
<span class="token keyword">private</span> <span class="token class-name">RabbitTemplate</span> rabbitTemplate<span class="token punctuation">;</span>

<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">demo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    rabbitTemplate<span class="token punctuation">.</span><span class="token function">convertAndSend</span><span class="token punctuation">(</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">,</span> <span class="token class-name">LocalDate</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@RabbitListener</span><span class="token punctuation">(</span>queues <span class="token operator">=</span> <span class="token string">&quot;hello&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MessageReceiver</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@RabbitHandler</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">process</span><span class="token punctuation">(</span><span class="token class-name">LocalDate</span> date<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;Receiver : {}&quot;</span><span class="token punctuation">,</span> date<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h2 id="_08-topic-exchange" tabindex="-1"><a class="header-anchor" href="#_08-topic-exchange" aria-hidden="true">#</a> 08. Topic Exchange</h2><p>Topic 是 RabbitMQ 中最灵活的一种方式，可以根据 routing_key 自由地绑定不同的队列。</p><blockquote><small>考虑到环境中残留的之前的相关信息对测试的影响，如果发现测试代码的执行结果『莫名其妙』，记得在 RabbitMQ 的 web 管理系统中将相关内容清除干净，构造一个纯净的测试环境测试。</small></blockquote><p><img src="https://hemiao3000.gitee.io/java-note-img/images/rabbitmq/img/spring-boot-rabbitmq-02.png" alt="rabbitmq"></p><p>首先对 Topic 规则配置：</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/* 两个 Queue */</span>
<span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span><span class="token string">&quot;Q1&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">Queue</span> <span class="token function">queue1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Queue</span><span class="token punctuation">(</span><span class="token string">&quot;Q1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

<span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span><span class="token string">&quot;Q2&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">Queue</span> <span class="token function">queue2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Queue</span><span class="token punctuation">(</span><span class="token string">&quot;Q2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

<span class="token comment">/* 一个 Exchange */</span>
<span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">TopicExchange</span> <span class="token function">topicExchange</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">TopicExchange</span><span class="token punctuation">(</span><span class="token string">&quot;topic-exchange&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

<span class="token comment">/* 三个 Binding：关联 Exchange 和 Queue */</span>
<span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">Binding</span> <span class="token function">binding1</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">&quot;Q1&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Queue</span> queue<span class="token punctuation">,</span> <span class="token class-name">TopicExchange</span> topicExchange<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token class-name">BindingBuilder</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>queue<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">to</span><span class="token punctuation">(</span>topicExchange<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">with</span><span class="token punctuation">(</span><span class="token string">&quot;*.orange.*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">Binding</span> <span class="token function">binding21</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">&quot;Q2&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Queue</span> queue<span class="token punctuation">,</span> <span class="token class-name">TopicExchange</span> topicExchange<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token class-name">BindingBuilder</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>queue<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">to</span><span class="token punctuation">(</span>topicExchange<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">with</span><span class="token punctuation">(</span><span class="token string">&quot;*.*.rabbit&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">Binding</span> <span class="token function">binding22</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">&quot;Q2&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Queue</span> queue<span class="token punctuation">,</span> <span class="token class-name">TopicExchange</span> topicExchange<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token class-name">BindingBuilder</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>queue<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">to</span><span class="token punctuation">(</span>topicExchange<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">with</span><span class="token punctuation">(</span><span class="token string">&quot;lazy.#&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><blockquote><p>即便不编写消费者，你也可以在管理台页面上，直接看到各个 Queue 中有多少条消息。</p></blockquote><p>创建两个消费者：</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@RabbitListener</span><span class="token punctuation">(</span>queues <span class="token operator">=</span> <span class="token string">&quot;Q1&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> C1 <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@RabbitHandler</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">process</span><span class="token punctuation">(</span><span class="token class-name">String</span> message<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;C1: {}&quot;</span><span class="token punctuation">,</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@RabbitListener</span><span class="token punctuation">(</span>queues <span class="token operator">=</span> <span class="token string">&quot;Q2&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> C2 <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@RabbitHandler</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">process</span><span class="token punctuation">(</span><span class="token class-name">String</span> message<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;C2: {}&quot;</span><span class="token punctuation">,</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>测试：<small>（这里偷了个懒，没有去创建发送者类，直接在 Junit 中使用了 <strong>AmqpTemplate</strong> 发送消息）</small>。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Autowired</span>
<span class="token keyword">private</span> <span class="token class-name">AmqpTemplate</span> rabbitTemplate<span class="token punctuation">;</span>


<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">demo1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
    rabbitTemplate<span class="token punctuation">.</span><span class="token function">convertAndSend</span><span class="token punctuation">(</span><span class="token string">&quot;testTopic&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;hello.orange&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;hello orange&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    rabbitTemplate<span class="token punctuation">.</span><span class="token function">convertAndSend</span><span class="token punctuation">(</span><span class="token string">&quot;testTopic&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;hello.orange.world&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;hello orange world&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    rabbitTemplate<span class="token punctuation">.</span><span class="token function">convertAndSend</span><span class="token punctuation">(</span><span class="token string">&quot;testTopic&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;hello.world.rabbit&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;hello world rabbit&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    rabbitTemplate<span class="token punctuation">.</span><span class="token function">convertAndSend</span><span class="token punctuation">(</span><span class="token string">&quot;testTopic&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;lazy&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;lazy&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    rabbitTemplate<span class="token punctuation">.</span><span class="token function">convertAndSend</span><span class="token punctuation">(</span><span class="token string">&quot;testTopic&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;lazy.good&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;good&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    rabbitTemplate<span class="token punctuation">.</span><span class="token function">convertAndSend</span><span class="token punctuation">(</span><span class="token string">&quot;testTopic&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;lazy.good.bye&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;goodbye&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h2 id="_09-fanout-exchange" tabindex="-1"><a class="header-anchor" href="#_09-fanout-exchange" aria-hidden="true">#</a> 09. Fanout Exchange</h2><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span> 
<span class="token keyword">public</span> <span class="token class-name">Queue</span> <span class="token function">green</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Queue</span><span class="token punctuation">(</span><span class="token string">&quot;green&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

<span class="token annotation punctuation">@Bean</span> 
<span class="token keyword">public</span> <span class="token class-name">Queue</span> <span class="token function">red</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Queue</span><span class="token punctuation">(</span><span class="token string">&quot;red&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

<span class="token annotation punctuation">@Bean</span> 
<span class="token keyword">public</span> <span class="token class-name">Queue</span> <span class="token function">orange</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Queue</span><span class="token punctuation">(</span><span class="token string">&quot;orange&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

<span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">FanoutExchange</span> <span class="token function">exchange</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">FanoutExchange</span><span class="token punctuation">(</span><span class="token string">&quot;testFanout&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

<span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">Binding</span> <span class="token function">binging1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token class-name">BindingBuilder</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token function">green</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">to</span><span class="token punctuation">(</span><span class="token function">exchange</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

<span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">Binding</span> <span class="token function">binging2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token class-name">BindingBuilder</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token function">red</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">to</span><span class="token punctuation">(</span><span class="token function">exchange</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

<span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">Binding</span> <span class="token function">binging3</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token class-name">BindingBuilder</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token function">orange</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">to</span><span class="token punctuation">(</span><span class="token function">exchange</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">demo2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
    rabbitTemplate<span class="token punctuation">.</span><span class="token function">convertAndSend</span><span class="token punctuation">(</span><span class="token string">&quot;testFanout&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;green&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    rabbitTemplate<span class="token punctuation">.</span><span class="token function">convertAndSend</span><span class="token punctuation">(</span><span class="token string">&quot;testFanout&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;red&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    rabbitTemplate<span class="token punctuation">.</span><span class="token function">convertAndSend</span><span class="token punctuation">(</span><span class="token string">&quot;testFanout&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;orange&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>Customer-A、Customer-B、Customer-C 都会收到这三条消息，即，控制台会打印出 9 条日志。</p><h2 id="_10-接收-消费消息-pull-型" tabindex="-1"><a class="header-anchor" href="#_10-接收-消费消息-pull-型" aria-hidden="true">#</a> 10. 接收/消费消息（PULL 型）</h2><p>PULL 型消费意味着需要消费者主动从 RabbitMQ Broker 上『取』消息。</p><p>PULL 型消费『<strong>不依靠</strong>』@RabbitListener 和 @RabbitHandler 注解。而是需要在代码中手动调用 <strong>.receiveAndConvert</strong> 方法。</p><p><small><em>.receiveAndConvert</em> 方法是 <em>.receive</em> 方法的简化版。</small></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">demo5</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    rabbitTemplate<span class="token punctuation">.</span><span class="token function">convertAndSend</span><span class="token punctuation">(</span><span class="token string">&quot;queue-demo-1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;hello world&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">demo4</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;{}&quot;</span><span class="token punctuation">,</span> rabbitTemplate<span class="token punctuation">.</span><span class="token function">receiveAndConvert</span><span class="token punctuation">(</span><span class="token string">&quot;queue-demo-1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h2 id="_11-发送者确认" tabindex="-1"><a class="header-anchor" href="#_11-发送者确认" aria-hidden="true">#</a> 11. 发送者确认</h2><blockquote><p>发送者如何知道自己所发送的消费成功抵达了 RabbitMQ Broker 中的 Exchange 中，乃至成功抵达了 RabbitMQ Broker 中的 Queue 中？</p><p><strong>生产者确认</strong></p></blockquote><h3 id="_11-a-确认消息已到-exchange" tabindex="-1"><a class="header-anchor" href="#_11-a-确认消息已到-exchange" aria-hidden="true">#</a> 11.a 确认消息已到 Exchange</h3><p>RabbitMQ 有一个配置属性 <code>spring.rabbitmq.publisher-confirm-type</code> 控制是否开启确认功能。该属性默认值是 <strong>NONE</strong> ，表示不开启消息确认。</p><ul><li><p>publisher-confirm-type = SIMPLE</p><p>当改属性的值为 <strong>SIMPLE</strong> 时，表示支持以简单<small>（同步阻塞等待）</small>方式获得确认与否的信息。</p><p>这里会调用 <strong>Template#waitForConfirms</strong> 方法，不过这个方法有个要求，它必须在 <strong>Template#invoke</strong> 方法中使用。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">String</span> str <span class="token operator">=</span> rabbitTemplate<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token punctuation">(</span>operations<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 参数 operations 实际上就是 Template 。</span>
    operations<span class="token punctuation">.</span><span class="token function">convertAndSend</span><span class="token punctuation">(</span><span class="token string">&quot;red&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;hello world&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;{}&quot;</span><span class="token punctuation">,</span> operations<span class="token punctuation">.</span><span class="token function">waitForConfirms</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// 阻塞等待 1 秒，以获得确认信息。</span>
    <span class="token keyword">return</span> <span class="token string">&quot;over&quot;</span><span class="token punctuation">;</span> <span class="token comment">// lambda 表达式的值将成为 invoke 方法的返回值。</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;{}&quot;</span><span class="token punctuation">,</span> str<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>你可以向不存在的 Exchange 发送消息已验证效果。</p></li><li><p>publisher-confirm-type = CORRELATED</p><p>当改属性的值为 <strong>CORRELATED</strong> 时，表示支持以异步回调方式获得确认与否的信息。</p><p>在之前的代码中，是 <code>spring-rabbit</code> 帮我们创建 <strong>ConnectionFactory</strong>，再进一步创建 <strong>RabbitTemplate</strong>，并注入到我们的代码中进而被我们使用。</p><p>现在由于需要对 <strong>RabbitTemplate</strong> 进行设置，因此，我们需要自己创建并设置 <strong>RabbitTemplate</strong>。<small>（不过，还是需要 spring-rabbit 帮我们创建 Connection Factory，并注入）</small></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">RabbitTemplate</span> <span class="token function">createRabbitTemplate</span><span class="token punctuation">(</span><span class="token class-name">ConnectionFactory</span> connectionFactory<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">RabbitTemplate</span> rabbitTemplate <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RabbitTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    rabbitTemplate<span class="token punctuation">.</span><span class="token function">setConnectionFactory</span><span class="token punctuation">(</span>connectionFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 设置开启 Mandatory，才能触发回调函数，无论消息推送结果怎么样都强制调用回调函数</span>
    rabbitTemplate<span class="token punctuation">.</span><span class="token function">setMandatory</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 当 Exchange 收到消息后，这里设置的回调方法会被触发执行</span>
    rabbitTemplate<span class="token punctuation">.</span><span class="token function">setConfirmCallback</span><span class="token punctuation">(</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> rabbitTemplate<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>你可以使用 lamda 表达式来简化下列匿名实现类。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>rabbitTemplate<span class="token punctuation">.</span><span class="token function">setConfirmCallback</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RabbitTemplate<span class="token punctuation">.</span>ConfirmCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token doc-comment comment">/**
     * 该方法无论 Exchange 能否收到消息都会执行。
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">confirm</span><span class="token punctuation">(</span><span class="token class-name">CorrelationData</span> correlationData<span class="token punctuation">,</span> <span class="token keyword">boolean</span> ack<span class="token punctuation">,</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>String</span> cause<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>ack<span class="token punctuation">)</span>
            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;消息已发送至 Exchange&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span> 
            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;消息未能发送到 Exchange。{}&quot;</span><span class="token punctuation">,</span> cause<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>




</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div></li></ul><h3 id="_11-b-确认消息已到-message-queue" tabindex="-1"><a class="header-anchor" href="#_11-b-确认消息已到-message-queue" aria-hidden="true">#</a> 11.b 确认消息已到 Message Queue</h3><div class="language-properties ext-properties line-numbers-mode"><pre class="language-properties"><code><span class="token comment">## 确认消息已发送到队列（Queue）</span>
<span class="token attr-name">spring.rabbitmq.publisher-returns</span><span class="token punctuation">=</span><span class="token attr-value">true</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">RabbitTemplate</span> <span class="token function">createRabbitTemplate</span><span class="token punctuation">(</span><span class="token class-name">ConnectionFactory</span> connectionFactory<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">RabbitTemplate</span> rabbitTemplate <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RabbitTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    rabbitTemplate<span class="token punctuation">.</span><span class="token function">setConnectionFactory</span><span class="token punctuation">(</span>connectionFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 设置开启 Mandatory，才能触发回调函数，无论消息推送结果怎么样都强制调用回调函数</span>
    rabbitTemplate<span class="token punctuation">.</span><span class="token function">setMandatory</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

    <span class="token comment">// 关键就是以下两句</span>
    rabbitTemplate<span class="token punctuation">.</span><span class="token function">setReturnCallback</span><span class="token punctuation">(</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> rabbitTemplate<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>你可以使用 lamda 表达式来简化下列匿名实现类。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>rabbitTemplate<span class="token punctuation">.</span><span class="token function">setReturnCallback</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RabbitTemplate<span class="token punctuation">.</span>ReturnCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token doc-comment comment">/**
     * 该方法在 Queue 无法收到消息时被触发执行。Queue 能收到消息，反而不会执行。
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">returnedMessage</span><span class="token punctuation">(</span><span class="token class-name">Message</span> message<span class="token punctuation">,</span> <span class="token keyword">int</span> replyCode<span class="token punctuation">,</span> <span class="token class-name">String</span> replyText<span class="token punctuation">,</span> <span class="token class-name">String</span> exchange<span class="token punctuation">,</span> <span class="token class-name">String</span> routingKey<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;ReturnCallback 消息：{}&quot;</span><span class="token punctuation">,</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;ReturnCallback 回应码：{}&quot;</span><span class="token punctuation">,</span> replyCode<span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;ReturnCallback 回应信息：{}&quot;</span><span class="token punctuation">,</span> replyText<span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;ReturnCallback 交换机：{}&quot;</span><span class="token punctuation">,</span> exchange<span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;ReturnCallback 路由键：{}&quot;</span><span class="token punctuation">,</span> routingKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>你可以向不存在的 Exchange 和 Queue 发送消息已验证效果。</p><h2 id="_12-消费端的确认与拒绝" tabindex="-1"><a class="header-anchor" href="#_12-消费端的确认与拒绝" aria-hidden="true">#</a> 12. 消费端的确认与拒绝</h2><p>默认情况下，RabbitMQ 启用的是消费端自动<small>（auto）</small>回复。即，当消费端收到消息，就会给 RabbitMQ Broker 作出回复，表示已收到。</p><p><strong>只有在消费端回复 RabbitMQ Broker 之后，RabbitMQ Broker 才会将该消息从消息队列中移除。</strong></p><p>回复的行为除了有 AUTO 之外，还有 NONE 和 MANUAL 。</p><p>NONE 表示不回复，即，RabbitMQ Broker 永远不可能知道消费者端到底有没有收到消息。RabbitMQ Broker 发出</p><p>MANUAL 则意味着需要在消费者端手动发送回复信息。在消费者回复前，该消息在消费端未回复前在 RabbitMQ Brocker 上一直处于 <strong>Unacked</strong> 状态。<small>如果消费者始终都不回复该消息，那么直到消费者与 RabbitMQ 断开连接之后，这条消息才会重新变为 Ready 状态。</small></p><p>启用消费端的确认功能需要打开配置开关：</p><div class="language-properties ext-properties line-numbers-mode"><pre class="language-properties"><code><span class="token attr-name">spring.rabbitmq.listener.simple.acknowledge-mode</span><span class="token punctuation">=</span><span class="token attr-value">manual</span>
<span class="token attr-name">spring.rabbitmq.listener.direct.acknowledge-mode</span><span class="token punctuation">=</span><span class="token attr-value">manual</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>于此同时，消息消费者的处理方法需要改造成以下形式：</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@RabbitListener</span><span class="token punctuation">(</span>queues <span class="token operator">=</span> <span class="token string">&quot;queue-demo-1&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Consumer2</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@RabbitHandler</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">process</span><span class="token punctuation">(</span><span class="token class-name">String</span> message<span class="token punctuation">,</span> 
            <span class="token class-name">Channel</span> channel<span class="token punctuation">,</span> 
            <span class="token annotation punctuation">@Header</span><span class="token punctuation">(</span><span class="token class-name">AmqpHeaders</span><span class="token punctuation">.</span>DELIVERY_TAG<span class="token punctuation">)</span> <span class="token keyword">long</span> tag<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h3 id="_12-1-确认消息" tabindex="-1"><a class="header-anchor" href="#_12-1-确认消息" aria-hidden="true">#</a> 12.1 确认消息</h3><p>确认消息使用 <strong>channel</strong> 的 <strong>.basicAck</strong> 方法：</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>channel<span class="token punctuation">.</span><span class="token function">basicAck</span><span class="token punctuation">(</span>tag<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>basicAck 方法需要传递两个参数：</p><ul><li><p>deliveryTag<small>（唯一标识 ID）</small>：当一个消费者向 RabbitMQ 注册后，会建立起一个 Channel<small>（Channel 是比 Connection 更小的单位）</small>，RabbitMQ 通过 Channel 向消费者投递消息时，都会为该消息分配一个唯一性标识：delivery tag 。同一个 Channel 中的消息的 delivery tag 都是唯一且单调递增的。</p></li><li><p>multiple：是否批量确认。当参数为 false 时，意味着确认单条消息，RabbitMQ 仅从消息队列中删除该消息；当参数为 true 时，意味着批量确认，RabbitMQ 会从消息队列中删除编号小于等于该消息的所有信息。</p></li></ul><h3 id="_12-2-拒绝消息" tabindex="-1"><a class="header-anchor" href="#_12-2-拒绝消息" aria-hidden="true">#</a> 12.2 拒绝消息</h3><p>拒绝消息使用 <em>channel</em> 的 <strong>.basicReject</strong> 方法：</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>channel<span class="token punctuation">.</span><span class="token function">basicReject</span><span class="token punctuation">(</span>tag<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>basicReject 方法也需要传力两个参数：</p><ul><li><p>deliveryTag（唯一标识 ID）：同上。</p></li><li><p>requeue（重入标识）：标识该消息是否需要 RabbitMQ Broker 重新入队。<small>（有可能的话，会被该队列的其它消费者消费）。</small></p></li></ul><p>另外，拒绝的方法还有 <strong>.basicNack</strong>，表示批量拒绝。</p><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><span class="meta-item-info">2021/8/23 下午5:35:44</span></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: hemiao3000@126.com">hemiao</span><!----><!--]--><!--]--></span></div></footer><nav class="page-nav"><p class="inner"><span class="prev"> ← <a href="/rabbitmq/01-%E7%AE%80%E4%BB%8B.html" class="nav-link" aria-label="RabbitMQ 简介"><!--[--><!--]--> RabbitMQ 简介 <!--[--><!--]--></a></span><span class="next"><a href="/rabbitmq/03-%E6%AD%BB%E4%BF%A1%E9%98%9F%E5%88%97.html" class="nav-link" aria-label="延迟队列"><!--[--><!--]--> 延迟队列 <!--[--><!--]--></a> → </span></p></nav><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script src="/assets/js/runtime~app.98b3ec54.js" defer></script><script src="/assets/js/1812.d943ba23.js" defer></script><script src="/assets/js/app.305f9df9.js" defer></script>
  </body>
</html>
